import{ja as f,x as u,y as D}from"./chunk-OQDNOSON.js";import"./chunk-C6Q5SG76.js";var p=class a{static csvConf={useKeysAsHeaders:!0,quoteCharacter:"",fieldSeparator:","};async resultsToCsv(t,e){let r=this._parceResults(t,e);import("./chunk-4UTBWCBA.js").then(s=>{let i=s.mkConfig(a.csvConf),o=s.generateCsv(i)(r);s.download(i)(o)})}_parceResults(t,e){if(t.MWDs.length!==t.soilPortions.length||t.soilPortions.length!==t.tamizDiameterProm.length)throw new Error("Resultados con mal formato: intente mas tarde");let r=[];for(let s=0;s<Array.from(e.keys()).length;s++){let i={soilWeight:e.get(s).soilWeight.toFixed(6),tamizDiameter:e.get(s).tamizDiameter.toFixed(6),tamizDiam:t.tamizDiameterProm[s]?.toFixed(6)??void 0,soilPortions:t.soilPortions[s]?.toFixed(6)??void 0,MWDs:t.MWDs[s]?.toFixed(6)??void 0};r.push(i)}return r[0].totalSoil=t.totalSoilWeight.toFixed(6),r[0].MWDTotal=t.MWDTotal,r}static \u0275fac=function(e){return new(e||a)};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};var n=class a{static getEmptyResults(){return{MWDTotal:-1,totalSoilWeight:-1,MWDs:[],soilPortions:[],tamizDiameterProm:[]}}static cleanResults(t){t=a.getEmptyResults()}static itHasProcessedData(t){return t.MWDTotal!==-1||t.totalSoilWeight!==-1||t.MWDs.length<=0||t.soilPortions.length<=0||t.tamizDiameterProm.length<=0}static areEquals(t,e){if(t.totalSoilWeight!==e.totalSoilWeight)return!1;for(let s=0;s<t.tamizDiameterProm.length;s++){let i=Number(t.tamizDiameterProm[s].toFixed(3)),o=e.tamizDiameterProm[s];if(i!==o)return!1}for(let s=0;s<t.soilPortions.length;s++){let i=t.soilPortions[s],o=e.soilPortions[s];if(i!==o)return!1}for(let s=0;s<t.MWDs.length;s++){let i=t.MWDs[s].toFixed(7),o=e.MWDs[s].toFixed(7);if(i!==o)throw new Error("Value expected and got different")}if(Number(t.MWDTotal.toFixed(2))!==e.MWDTotal)throw new Error("Value expected and got different");return!1}};var c=class a{_samplesRows;_results=n.getEmptyResults();static precision=9;setData(t){this._samplesRows=t,this._adustPrecisionSample(),n.itHasProcessedData(this._results)&&n.cleanResults(this._results)}calcTotalSoilWeight(){if(this._results.totalSoilWeight!=-1)return this._results.totalSoilWeight;let t=0;return this._getSoilWeights().forEach(r=>{t=t+r}),this._results.totalSoilWeight=t,this._results.totalSoilWeight}calcTamizDiameterProm(){if(this._results.tamizDiameterProm.length!==0)return this._results.tamizDiameterProm;let t=[],e=this._getTamizDiameters();for(let r=0;r<e.length-1;r++){let s=e[r],i=e[r+1],l=(s+i)/2;t.push(l)}return this._results.tamizDiameterProm=t,this._results.tamizDiameterProm}calcSoilPortions(){if(this._results.soilPortions.length!==0)return this._results.soilPortions;let t=this._getSoilWeights();t.shift();let e=this.calcTotalSoilWeight(),r=t.map(s=>{let i=s/e;return this._adustPrecision(Number(i.toFixed(9)))});return this._results.soilPortions=r,this._results.soilPortions}calcMWDs(){if(this._results.MWDs.length!==0)return this._results.MWDs;let t=this.calcTamizDiameterProm(),e=this.calcSoilPortions();if(t.length!=e.length)throw new Error("unexpected: soilWeights.length != soilPortions.length");let r=[];for(let s=0;s<t.length;s++){let i=t[s],o=e[s],l=i*o,m=this._adustPrecision(l);r.push(m)}return this._results.MWDs=r,this._results.MWDs}calcMWDTotal(){if(this._results.MWDTotal!=-1)return this._results.MWDTotal;let t=this.calcMWDs(),e=0;for(let r=0;r<t.length;r++)e=e+t[r];return this._results.MWDTotal=e,this._results.MWDTotal}_getTamizDiameters(){return Array.from(this._samplesRows.values()).map(e=>e.tamizDiameter)}_getSoilWeights(){return Array.from(this._samplesRows.values()).map(e=>e.soilWeight)}_adustPrecision(t){return Number(t.toFixed(a.precision))}_adustPrecisionSample(){this._samplesRows.values()}getResults(){let t=n.getEmptyResults();return Object.assign(t,this._results),t}};var h=class a{resolveSamples(t){let e=new c;return e.setData(t),e.calcTotalSoilWeight(),e.calcTamizDiameterProm(),e.calcSoilPortions(),e.calcMWDs(),e.calcMWDTotal(),e.getResults()}async parseFileToSamples(t){return new Promise(async(r,s)=>{let i=await import("./chunk-4F5CMFQX.js");new i.Papa().parse(t,{complete:(l,m)=>{let W=this._parseDataFileToSample(l.data);r(W)},error:l=>{s(l)}})})}_parseDataFileToSample(t){let r=t.map(i=>i.slice(0,2));isNaN(Number(r[0][0]))&&(console.log("has header"),r.shift());let s=new Map;for(let i=0;i<r.length-1;i++){let o=r[i],l=Number(o[0]);if(isNaN(l))throw new Error("bad format in: '"+o[0]+"'");let m=Number(o[1]);if(isNaN(m))throw new Error("bad format in: '"+o[1]+"'");s.set(i,{soilWeight:l,tamizDiameter:m})}return s}static \u0275fac=function(e){return new(e||a)};static \u0275prov=u({token:a,factory:a.\u0275fac})};var d=class a{getOutputDriver(){return new p}getInputDriver(){return new h}static \u0275fac=function(e){return new(e||a)};static \u0275mod=f({type:a});static \u0275inj=D({})};export{d as CalcMwdModule};
